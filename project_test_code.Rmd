---
title: "Project_test-code"
author: "Ken Vu"
date: "`r Sys.Date()`"
output: pdf_document
---

Code to screw around with the data set.
```{r}
library(pacman)
p_load(dplyr, ggplot2, readr, forcats, knitr, kableExtra)
```

# Loading in Data Set (Skip if Done)
Getting in women in stem data
```{r}
women_stem <- read_csv("women-stem.csv")
women_stem
```

Getting in `recent_grad` data set
```{r}
recent_grads <- read_csv("recent-grads.csv")
recent_grads
```


## Merging the two data sets by major
```{r}
full_data <- women_stem %>%
  inner_join(recent_grads %>% 
               select(Major, contains("employ")), by="Major")
full_data
```

# EDA
```{r}
dat_stats <- full_data %>%
  group_by(Major_category) %>%
  summarise(TotalEmployed=sum(Employed),
            TotalUnemployed=sum(Unemployed),
            Prop_Employed=TotalEmployed/(TotalEmployed + TotalUnemployed),
            Prop_Unemployed=TotalUnemployed/(TotalEmployed + TotalUnemployed))
dat_stats
```

The data for unemployment rate by major category
```{r}
dat_stats1 <- full_data %>%
  group_by(Major_category) %>% 
  summarise(UnemploymentRate=sum(Unemployed)/sum(Employed))
dat_stats1
```

Plot for unemployment rate by category
```{r}
dat_stats1 %>%
  mutate(Major_category = Major_category %>% as.factor() %>% fct_reorder(UnemploymentRate)) %>%
  ggplot(aes(x=Major_category,y=UnemploymentRate, 
             fill=Major_category)) + 
  geom_col() + 
  labs(x="Major Category", y="Unemployment Rate",
       title="Unemployment Rate by Major Category") +
  theme(axis.text.x = element_text(angle=8),
        legend.position="None",
        plot.title=element_text(hjust=0.5,size=20))
```

```{r}
dat_stats1 <- dat_stats1 %>%
  mutate(Major_category = Major_category %>% as.factor() %>%
           fct_reorder(UnemploymentRate))
dat_stats1
```

# Testing Out Lydia's Suggestions
FIrst, get a data frame with summary statistics for all major categories
```{r}
dat_stats_all <- recent_grads %>%
  group_by(Major_category) %>%
  summarise(UnemploymentRate = sum(Unemployed)/sum(Employed),
            AvgMedianSalary = mean(Median)) %>%
  mutate(Major_category = Major_category %>% as.factor() %>%
           fct_reorder(UnemploymentRate),
         STEM_Major = ifelse(!(Major_category %in% unique(women_stem$Major_category)),
                             "No","Yes") %>% as.factor() %>%
           fct_relevel("Yes"))
dat_stats_all
```

Getting mean unemployment rate
```{r}
avg_unemployment_rate = mean(recent_grads$Unemployment_rate)
avg_unemployment_rate
```


```{r}
dat_stats_all %>%
  ggplot(aes(y=Major_category, 
             x=UnemploymentRate, fill=STEM_Major)) +
  geom_col() + 
  # manually change fill colors
  scale_fill_manual(values=c("#0066CC","#bebebe")) +
  # add red line representing average unemployment rate 
  geom_vline(xintercept=avg_unemployment_rate,
             color="red", size=2) + 
  labs(x="Unemployment Rate", y="Major Category",
       title="Unemployment Rate by Major Category",
       fill="STEM") + 
  # change title size
  theme(plot.title=element_text(hjust=0.5,size=20)) + 
  # annotate vertical line
  annotate("text",x=avg_unemployment_rate + 0.014,
           y=5, label="average", color="red") + 
  annotate("text",x=mean(recent_grads$Unemployment_rate) + 0.02,
           y=4.25, label="unemployment", color="red")
```

As we can see in this bar chart above, we find that of all the STEM major categories, Computer Science & Mathematics has the highest unemployment rate (which is around 0.0772), which is also greater than the average unemployment rate across all major categories (which is around 0.0682).

Want a table 
so for each major category, the unemployment rate and the average median salary
```{r}
df1 <- dat_stats_all %>% 
  arrange(desc(AvgMedianSalary)) %>%
  select(c("Major_category","AvgMedianSalary","UnemploymentRate"))
names(df1) <- c("Major Category", "Average Median Salary",
                "Unemployment Rate")
df1 %>% 
  kable(format="markdown")
```

